---
layout: single
title: ì‹¤ìŠµ 2. Feast ê¸°ë³¸ ì˜ˆì œ - (2) Feature ì¶”ì¶œ ë° ì¶”ë¡ 
date: 2022-04-29 10:23:00 +0900
last_modified_at: 2022-04-29 10:23:00 +0900
category: mlops
tags: ["Feast Feature Store êµ¬ì¶• ì‹¤ìŠµ"]
published: false

---

<aside>
ğŸ’¡ **ì‹¤ìŠµ ëª©í‘œ
1. Store ë¡œë¶€í„° í›ˆë ¨ ë°ì´í„° ì¶”ì¶œí•˜ê¸°
2. Online Store ë¡œ ë°ì´í„°ë¥¼ ì ì¬í•˜ê³  ì¶”ë¡ ì„ ìœ„í•œ Feature Vector ê°€ì ¸ì˜¤ê¸°**

</aside>

### **Store ë¡œë¶€í„° í›ˆë ¨ ë°ì´í„° ì¶”ì¶œí•˜ê¸°**

- í›ˆë ¨ ë°ì´í„° ì¶”ì¶œ
    - get_historical_features ë¡œ ë°ì´í„° ì¶”ì¶œ
        
        ```python
        from datetime import datetime, timedelta
        import pandas as pd
        
        from feast import FeatureStore
        
        # The entity dataframe is the dataframe we want to enrich with feature values
        entity_df = pd.DataFrame.from_dict(
            {
                "driver_id": [1001, 1002, 1003],
                "label_driver_reported_satisfaction": [1, 5, 3], 
                "event_timestamp": [
                    datetime.now() - timedelta(minutes=11),
                    datetime.now() - timedelta(minutes=36),
                    datetime.now() - timedelta(minutes=73),
                ],
            }
        )
        
        store = FeatureStore(repo_path=".")
        
        training_df = store.get_historical_features(
            entity_df=entity_df,
            features=[
                "driver_hourly_stats:conv_rate",
                "driver_hourly_stats:acc_rate",
                "driver_hourly_stats:avg_daily_trips",
            ],
        ).to_df()
        
        print("----- Feature schema -----\n")
        print(training_df.info())
        
        print()
        print("----- Example features -----\n")
        print(training_df.head())
        ```
        

### **Online Store ë¡œ ë°ì´í„°ë¥¼ ì ì¬í•˜ê³  ì¶”ë¡ ì„ ìœ„í•œ Feature Vector ê°€ì ¸ì˜¤ê¸°**

- Online Store ë¡œ ë°ì´í„° ì ì¬
    - Serving ì„ í•˜ê¸° ìœ„í•´ materialize-incremental ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ê°€ì¥ ìµœê·¼ ì‹¤í–‰ëœ materialize ì´í›„ì˜ ëª¨ë“  ìƒˆë¡œìš´ feature ê°’ë“¤ì„ serialization ì‹œì¼œ ì¤€ë‹¤.
        
        ```python
        from datetime import datetime
        !feast materialize-incremental {datetime.now().isoformat()}
        ```
        
    - materialized features í™•ì¸
        
        ```python
        print("--- Data directory ---")
        !ls data
        
        import sqlite3
        import pandas as pd
        con = sqlite3.connect("data/online_store.db")
        print("\n--- Schema of online store ---")
        print(
            pd.read_sql_query(
                "SELECT * FROM feature_repo_driver_hourly_stats", con).columns.tolist())
        con.close()
        ```
        
- ì¶”ë¡ ì„ ìœ„í•œ Feature Vector ê°€ì ¸ì˜¤ê¸°
    - get_online_features ë¡œ ë°ì´í„° ì¶”ì¶œ
        
        ```python
        from pprint import pprint
        from feast import FeatureStore
        
        store = FeatureStore(repo_path=".")
        
        feature_vector = store.get_online_features(
            features=[
                "driver_hourly_stats:conv_rate",
                "driver_hourly_stats:acc_rate",
                "driver_hourly_stats:avg_daily_trips",
            ],
            entity_rows=[
                {"driver_id": 1004},
                {"driver_id": 1005},
            ],
        ).to_dict()
        
        pprint(feature_vector)
        ```