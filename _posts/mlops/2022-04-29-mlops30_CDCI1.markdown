---
layout: single
title: ì‹¤ìŠµ 1. Github Actions ê¸°ë°˜ CI/CD - Build ì™€ Push
date: 2022-04-29 11:23:00 +0900
last_modified_at: 2022-04-29 11:23:00 +0900
category: mlops
tags: ["CI/CD Pipeline"]
published: false

---

<aside>
ğŸ’¡ **ì‹¤ìŠµ ëª©í‘œ
1. Github Actions ë¥¼ í™œìš©í•˜ì—¬ Docker Image ë¥¼ Build í•œë‹¤.
2. ìƒì„±í•œ Docker Image ë¥¼ Docker Hub ì— Push í•œë‹¤.**

</aside>

### **Github Actions ë¥¼ í™œìš©í•˜ì—¬ Docker Image ë¥¼ Build**

- Github ì— ì ‘ì†í•˜ì—¬ ìƒˆë¡œìš´ Repository (github-actions-project) ìƒì„±
- Actions í´ë¦­
    - ë§¤ìš° ë‹¤ì–‘í•œ íˆ´ë“¤ì„ í†µí•©í•˜ê¸° ì‰½ê²Œ ë˜ì–´ ìˆìŒ
- Python Application ì„ íƒ
- Workflow file ìƒì„±
    - yml ë‚´ìš©ì„ vscode ë¡œ ê°€ì ¸ì˜¤ê¸°
    - Github event ì•Œì•„ë³´ê¸°
        - [https://docs.github.com/en/actions/learn-github-actions/events-that-trigger-workflows](https://docs.github.com/en/actions/learn-github-actions/events-that-trigger-workflows)
        
        ```yaml
        name [optional]
        on [required] events
        	: workflow ë¥¼ ì‹œì‘í•˜ê²Œ í•  ìˆ˜ ìˆëŠ” Github event ì˜ ì´ë¦„
        	: jobs [required]   jobs.<job_id>
        	: one or more jobs 
        	: sequence of tasks (steps)
        	: steps 1) can run commands, 2) setup tasks 3) run an action
        		- uses : selects an action (actions/ ë‹¤ìŒì—ëŠ” ì¬ì‚¬ìš© ê°€ëŠ¥ ì½”ë“œ ìœ„ì¹˜)
        		- run  : runs a command-line command
        ```
        
        ```yaml
        name: Python application
        
        on:
          push:
            branches: [ python-ci-workflow ]
          pull_request:
            branches: [ python-ci-workflow ]
        
        jobs:
          build:
            steps:
            - uses: actions/checkout@v2
            - name: Set up Python
              uses: actions/setup-python@v2
              with:
                python-version: "3.8"
            - name: Display Python version
              run: python -c "import sys; print(sys.version)"
        ```
        
    - actions ì•Œì•„ë³´ê¸°
        - [https://github.com/actions](https://github.com/actions)
        - checkout - action.yaml
    - yml íŒŒì¼ ì´ë¦„ì„ ci.yml ìœ¼ë¡œ ë³€ê²½
    - Start commit â†’ Create a new branch.. â†’ ì´ë¦„ì„ 'python-ci-workflow' ë¡œ ë³€ê²½ â†’ Create pull request
    - Details í´ë¦­ â†’ build
    - ì´ ì½”ë“œë“¤ì€ ì–´ë””ì„œ ì‹¤í–‰ë˜ëŠ” ê±¸ê¹Œ?
        - Github ì— ì˜í•´ ê´€ë¦¬ëœë‹¤
        - Workflow ì˜ ê° jobs ì€ ìƒˆë¡œìš´ ê°€ìƒ í™˜ê²½ì—ì„œ ì‹¤í–‰ëœë‹¤
- runs-on ì€ ì‹¤í–‰ë˜ëŠ” ì„œë²„ì˜ ìš´ì˜ì²´ì œë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.
    - ubuntu, Windows, Mac
    
    ```yaml
    jobs:
    	build:
    		runs-on: ubuntu-latest
    		strategy:
    			matrix:
    				os: [ubuntu-latest, windows-latest, macOS-latest]
    ```
    
- ci.yml ì„ ì—…ë°ì´íŠ¸ í•œë‹¤.
    - ì„¸ ê°€ì§€ ìš´ì˜ ì²´ì œ ëª¨ë‘ì—ì„œ ì„¸ ê°œì˜ ë¹Œë“œê°€ ë³‘ë ¬ë¡œ ì‹¤í–‰ëœë‹¤.
    
    ```yaml
    name: Python application
    
    on:
      push:
        branches: [ python-ci-workflow ]
      pull_request:
        branches: [ python-ci-workflow ]
    
    jobs:
      build:
        runs-on: ${{ matrix.os }}
        strategy:
          matrix:
            os: [ubuntu-latest, macos-latest, windows-latest]
            python-version: ['3.6', '3.8']
            exclude:
              - os: macos-latest
                python-version: '3.8'
              - os: windows-latest
                python-version: '3.6'
    
        steps:
        - uses: actions/checkout@v2
        - name: Set up Python
          uses: actions/setup-python@v2
          with:
            python-version: ${{ matrix.python-version }}
        - name: Display Python version
          run: python -c "import sys; print(sys.version)"
    ```
    

### **ìƒì„±í•œ Docker Image ë¥¼ Docker Hub ì— Push í•œë‹¤.**

- Workflow ì„¤ëª…
    - ì‘ì„±í•œ App ì„ ë¹Œë“œí•œë‹¤
    - Docker ì´ë¯¸ì§€ë¡œ ìƒì„±í•œë‹¤
    - Docker Repository ë¡œ ì¶”ê°€í•œë‹¤
- Dockerfile ì˜ˆì œ ê°€ì ¸ì˜¤ê¸°
    - [https://docs.docker.com/language/python/build-images/](https://docs.docker.com/language/python/build-images/)
        
        ```docker
        # syntax=docker/dockerfile:1
        
        FROM python:3.8-slim-buster
        
        WORKDIR /app
        
        COPY requirements.txt requirements.txt
        RUN pip3 install -r requirements.txt
        
        COPY . .
        
        CMD [ "python3", "-m" , "flask", "run", "--host=0.0.0.0"]
        ```
        
- Docker Image ë¹Œë“œ
    - Docker hub ë¡œ ì´ë™ ([https://hub.docker.com/](https://hub.docker.com/))
    - github-actions-app ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ repo ìƒì„±
    - êµ¬ê¸€ì—ì„œ docker build and push action ìœ¼ë¡œ ê²€ìƒ‰ ([https://github.com/marketplace/actions/docker-build-push-action](https://github.com/marketplace/actions/docker-build-push-action))
        - Docker Hub ì§€ì›
        - Secrets ì„¤ì • í•„ìš”
            - github - settings - Secrets - New
            - Name : DOCKER_USERNAME - yunjjun
            - Name : DOCKER_PASSWORD - dockerhub ì—ì„œ access token ìƒì„±
            - ë¹„ë°€ë²ˆí˜¸ì˜ ê²½ìš° ì‹¤ì œ ë¹„ë°€ë²ˆí˜¸ì™€ Access Tokens ëª¨ë‘ ê°€ëŠ¥
    - ë‹¤ì–‘í•œ [Inputs](https://github.com/marketplace/actions/docker-build-push-action#inputs)
    - ì¶”ê°€í•  Dockerfile
        
        ```yaml
          - name: Build & push Docker image
            uses: mr-smithers-excellent/docker-build-push@v5
        		with:
        		  image: docker-hub-repo/image-name
        			tags: v2, latest
        		  registry: docker.io
        		  username: ${{ secrets.DOCKER_USERNAME }}
        		  password: ${{ secrets.DOCKER_PASSWORD }}
        ```
        
    - [ë³¸ì¸ Docker Hub ì•„ì´ë””]/github-actions-app ìœ¼ë¡œ image ë³€ê²½
    - os ëŠ” ubuntu-latest ë§Œ ë‚¨ê²¨ë‘ê¸°
- ci.yml ìµœì¢…ë³¸
    
    ```yaml
    name: Python application
    
    on:
      push:
        branches: [ python-ci-workflow ]
      pull_request:
        branches: [ python-ci-workflow ]
    
    jobs:
      build:
        runs-on: ubuntu-latest
        steps:
        - uses: actions/checkout@v2
        - name: Set up Python
          uses: actions/setup-python@v2
          with:
            python-version: "3.8"
        - name: Display Python version
          run: python -c "import sys; print(sys.version)"
        - name: Build & push Docker image
          uses: mr-smithers-excellent/docker-build-push@v5
          with:
            image: yunjjun/github-actions-app
            tags: v3, latest
            registry: docker.io
            username: ${{ secrets.DOCKER_USERNAME }}
            password: ${{ secrets.DOCKER_PASSWORD }}
    ```