---
layout: single
title: ì‹¤ìŠµ 1. Feast ê¸°ë³¸ ì˜ˆì œ - (1) Store ìƒì„±ê³¼ ë°°í¬
date: 2022-04-19 16:47:00 +0900
last_modified_at: 2022-04-19 16:47:00 +0900
category: mlops
tags: ["Feast Feature Store êµ¬ì¶• ì‹¤ìŠµ"]
published: false
---

- ë¨¼ì € ì‚¬ìš© ë°©ë²•ì„ ìµíˆê¸° ìœ„í•´ì„œ [Feast ê³µì‹ ì‚¬ì´íŠ¸](https://feast.dev/) ë‚´ì˜ ì˜ˆì œë¥¼ ê°™ì´ ì‹¤í–‰í•´ ë³´ê² ìŠµë‹ˆë‹¤.
    - ë³¸ ì‹¤ìŠµì˜ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ì€ ê³µì‹ ì‚¬ì´íŠ¸ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¹ ë¥¸ ì†ë„ë¡œ ìƒˆë¡œìš´ ë¦´ë¦¬ì¦ˆê°€ ë‚˜ì˜¤ê³  ë³€í™”ê°€ ë§ì€ ë§Œí¼, ê°•ì˜ ì‹¤ìŠµìœ¼ë¡œ ì „ì²´ì ì¸ ì‚¬ìš©ë²•ì„ ìµíŒ í›„ì—ëŠ” í•­ìƒ ìµœì‹  ë¬¸ì„œë¥¼ í™•ì¸í•˜ì…”ì„œ ìƒˆë¡œìš´ ì—…ë°ì´íŠ¸ ì‚¬í•­ì„ í™•ì¸í•˜ì‹  í›„ í™œìš©í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
    [https://github.com/feast-dev/feast/releases](https://github.com/feast-dev/feast/releases)

<aside>
ğŸ’¡ **ì‹¤ìŠµ ëª©í‘œ
1. Feast Feature Store ë¥¼ ìƒì„±í•˜ì—¬ ê° Feature ë“¤ì„ ì •ì˜í•˜ì—¬ Store ì— ë°°í¬í•˜ê¸°**

</aside>

### **Feast Feature Store ë¥¼ ìƒì„±í•˜ì—¬ ê° Feature ë“¤ì„ ì •ì˜í•˜ì—¬ Store ì— ë°°í¬í•˜ê¸°**

- feature store ì‘ì—…ì„ í•  ê²½ë¡œë¡œ ì´ë™
    
    ```bash
    mkdir -p mlops/feature_store && cd mlops/feature_store
    ```
    
- Jupyter Lab Docker Container ì‹¤í–‰
    
    ```bash
    docker run -d --name jupyter -p 8888:8888 -e JUPYTER_TOKEN='password' \
    -v "$PWD":/home/jovyan/jupyter --user root --restart=always \
    -it jupyter/base-notebook start.sh jupyter lab
    ```
    
- [localhost:8888](http://localhost:8888) ì ‘ì†
- jupyter í´ë”ì—ì„œ ìƒˆ ë…¸íŠ¸ë¶ íŒŒì¼ ìƒì„±
- Store ìƒì„±ê³¼ ë°°í¬
    - **Feast ì„¤ì¹˜í•˜ê¸°**
        
        ```python
        %%sh
        pip install feast -U -q
        pip install Pygments -q
        ```
        
        - pip install ... -U : ì§€ì •ëœ ëª¨ë“  íŒ¨í‚¤ì§€ë¥¼ ìµœì‹ ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œ
        - pip install ... -q : ì¶œë ¥ ìµœì†Œí™”
        - Pygments : ì½”ë“œ ê°•ì¡° ê¸°ëŠ¥
    - Runtime ì¬ì‹œì‘
    - Feast ì €ì¥ì†Œ ì´ˆê¸°í™”
        
        ```python
        !feast init feature_repo
        ```
        
    - ìƒì„±ëœ Feature ì €ì¥ì†Œ í™•ì¸
        
        ```python
        %cd feature_repo
        !ls -R
        ```
        
        - ê° í´ë”/íŒŒì¼ í™•ì¸
        
        ```python
        !pygmentize -f terminal16m example.py
        ```
        
        - data : Feast ì—ì„œ ì œê³µí•˜ëŠ” ë°ëª¨ ë°ì´í„° (parquet í˜•ì‹)
        - example.py : ë°ëª¨ ë°ì´í„°ì˜ Feature ì •ì˜
            
            <!-- ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/07df8b8c-01ec-43da-bb20-3e75eb6111da/Untitled.png) -->
            ![Untitled](/assets/img/mlops_feast_1_1.png)
            
            - [Data Source](https://rtd.feast.dev/en/master/#module-feast.data_source)
                
                <!-- ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/bf3ec51a-90f7-42ff-93b7-faf695dd8ce9/Untitled.png) -->
                ![Untitled](/assets/img/mlops_feast_1_2.png)
                
            - [Feature](https://rtd.feast.dev/en/master/#module-feast.feature)
                - name, dtype, labels ì •ì˜
            - [Entity](https://rtd.feast.dev/en/master/#module-feast.entity)
                - ê´€ë ¨ëœ Feature ë“¤ì˜ ëª¨ìŒìœ¼ë¡œ primary key ì—­í• 
                - Entity key
                    
                    <!-- ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ae3afd03-bd8c-412b-89ff-19d295054342/Untitled.png) -->
                    ![Untitled](/assets/img/mlops_feast_1_3.png)
                    
            - Feature View ë‚´ [ë‹¤ë¥¸ ë°ì´í„° ì›ì²œ](https://docs.feast.dev/reference/data-sources) ì‚¬ìš©
                - BigQuery ì˜ˆì‹œ
                    
                    ```python
                    driver_stats_fv = **FeatureView**(
                        name="driver_activity",
                        **entities**=["driver"],
                        features=[
                            **Feature**(name="trips_today", dtype=ValueType.INT64),
                            Feature(name="rating", dtype=ValueType.FLOAT),
                        ],
                        batch_source=**BigQuerySource**(
                            table_ref="feast-oss.demo_data.driver_activity"
                        )
                    )
                    ```
                    
                - ì˜¤í”„ë¼ì¸(í•™ìŠµ) ë°ì´í„°ì™€ ì˜¨ë¼ì¸(ì¶”ë¡ ) í™˜ê²½ ëª¨ë‘ì—ì„œ ì¼ê´€ëœ ë°©ì‹ìœ¼ë¡œ Feature ë°ì´í„°ë¥¼ ëª¨ë¸ë§ í•  ìˆ˜ ìˆê²Œ í•¨
                - ë§Œì•½ FeatureView ê°€ íŠ¹ë³„í•œ entity ì™€ ê´€ê³„ê°€ ì—†ëŠ” feature ë“¤ë§Œ í¬í•¨í•œë‹¤ë©´ entities ê°€ ì—†ì´ (entities=[ ]) êµ¬ì„±ë  ìˆ˜ ìˆìŒ
                    
                    ```python
                    global_stats_fv = FeatureView(
                        name="global_stats",
                        entities=[],
                        features=[
                            Feature(name="total_trips_today_by_all_drivers", dtype=ValueType.INT64),
                        ],
                        batch_source=BigQuerySource(
                            table_ref="feast-oss.demo_data.global_stats"
                        )
                    )
                    ```
                    
                - Entity aliasing
                    
                    ```python
                    # location_stats_feature_view.py
                    from feast import Entity, Feature, FeatureView, FileSource, ValueType
                    location = Entity(name="location", join_key="location_id", value_type=ValueType.INT64)
                    location_stats_fv= FeatureView(
                        name="location_stats",
                        entities=["location"],
                        features=[
                            Feature(name="temperature", dtype=ValueType.INT32)
                        ],
                        batch_source=BigQuerySource(
                            table_ref="feast-oss.demo_data.location_stats"
                        ),
                    )
                    
                    # temperatures_feature_service.py
                    from location_stats_feature_view import location_stats_fv
                    temperatures_fs = FeatureService(
                        name="temperatures",
                        features=[
                            location_stats_feature_view
                                .with_name("origin_stats")
                                .with_join_key_map(
                                    {"location_id": "origin_id"}
                                ),
                            location_stats_feature_view
                                .with_name("destination_stats")
                                .with_join_key_map(
                                    {"location_id": "destination_id"}
                                ),
                        ],
                    )
                    ```
                    
            
            - Feature service
                - ì—¬ëŸ¬ ê°œì˜ Feature View ë¥¼ í¬í•¨í•  ìˆ˜ ìˆìŒ
                - MLëª¨ë¸ ë‹¹ í•˜ë‚˜ë¥¼ ìƒì„±í•˜ì—¬ ëª¨ë¸ì´ ì‚¬ìš©í•˜ëŠ” Feature ë¥¼ ì¶”ì í•  ìˆ˜ ìˆìŒ
                    - ëˆ„ì ëœ Feature ê°’ë“¤ì„ ì–»ê¸° ìœ„í•œ Feature View ë“¤ì„ í†µí•´ í›ˆë ¨ ë°ì´í„°ë¥¼ ìƒì„±í•´ë‚´ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŒ.
                    - ë‹¨ì¼ ë°ì´í„°ì…‹ì€ ì—¬ëŸ¬ ê°œì˜ Feature view ë“¤ë¡œë¶€í„°ì˜ Feature ë“¤ë¡œ êµ¬ì„± ê°€ëŠ¥í•¨
                    - Online Store ë‚˜ Offline Store ë¡œë¶€í„° Feature ë“¤ì„ ì¶”ì¶œí•  ë•Œ ì—¬ëŸ¬ ê°œì˜ Feature Views ë¡œ êµ¬ì„±ëœ Feature service ë¡œë¶€í„° ê²€ìƒ‰í•  ìˆ˜ ìˆìŒ
                        
                        ```python
                        from feast import FeatureStore
                        # Store ì´ˆê¸°í™”
                        feature_store = FeatureStore('.')
                        # Feature Serivce ì¶”ì¶œ
                        feature_service = feature_store.get_feature_service("driver_activity")
                        # í•´ë‹¹ Feature Service ì— í•´ë‹¹í•˜ëŠ” Feature ë“¤ì„ entity_dict ê¸°ì¤€ìœ¼ë¡œ ì¶”ì¶œ
                        # 1. Online Store
                        features = feature_store.get_online_features(
                            features=feature_service, entity_rows=[entity_dict]
                        )
                        # 2. Offline Store
                        
                        ```
                        
                        - Online Store
                            - latency ê°€ ë‚®ì€ Online feature ì¡°íšŒì— ì‚¬ìš©ë¨
                            - materialize ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ Feature View ì˜ ë°ì´í„° ì›ì²œìœ¼ë¡œë¶€í„° Online Store ë¡œ load ë¨
                            - Online Store ì˜ Feature ì €ì¥ ë°©ì‹ì€ ë°ì´í„° ì›ì²œì˜ ì €ì¥ ë°©ì‹ì„ ê·¸ëŒ€ë¡œ ë”°ë¦„
                            - Online Store ì™€ ë°ì´í„° ì›ì²œ ê°„ì˜ ê°€ì¥ í° ì°¨ì´ì ì€ entity key ë§ˆë‹¤ì˜ ìµœì‹  Feature ê°’ë§Œ ì €ì¥ë¨. ëˆ„ì ê°’ë“¤ì´ ì €ì¥ë˜ì§€ ì•ŠìŒ
                            - ë°ì´í„° ì›ì²œ ì˜ˆ
                            
                            <!-- ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/227edf57-fb93-46f4-b9cd-b6238ea3bd6d/Untitled.png) -->
                            ![Untitled](/assets/img/mlops_feast_1_4.png)
                            
                            - Online Store ëª¨ìŠµ
                            
                            <!-- ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f10cbbe2-0f10-4226-9852-60350830e800/Untitled.png) -->
                            ![Untitled](/assets/img/mlops_feast_1_5.png)
                            
                        - Offline Store
                            - ëˆ„ì ë˜ëŠ” Feature ë“¤ë¡œë¶€í„° í›ˆë ¨ ë°ì´í„°ë¥¼ ìƒì„±í•  ë•Œ ì‚¬ìš©
                            - ë¹ ë¥¸ ì¶”ë¡ ì„ ìœ„í•´ Feature ë“¤ì´ í•„ìš”í•  ë•Œ Offline Store ë¡œë¶€í„° Feature ë“¤ì„ materializing í•˜ì—¬ load í•¨
                            
        - feature_store.yaml : registry, provider, online_store ê²½ë¡œ ì„¤ì •
            
            ```bash
            !pygmentize feature_store.yaml
            ```
            
            - registry
                - ëª¨ë“  Feature ë“¤ì˜ ì •ì˜ì™€ ë©”íƒ€ë°ì´í„°ê°€ ëª¨ì—¬ ìˆëŠ” ê³³
                - ì‘ì—…ìë“¤ì˜ ê³µë™ ì‘ì—…ì„ ê°€ëŠ¥í•˜ê²Œ í•¨
                - Feast ë°°í¬ë§ˆë‹¤ í•˜ë‚˜ì˜ registry ê°€ ì¡´ì¬í•¨
                - íŒŒì¼ ê¸°ë°˜ì„ ê¸°ë³¸ìœ¼ë¡œ í•˜ë©° Local, S3, GCS ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•  ìˆ˜ ìˆìŒ
                - entities, feature views, feature services ë“±ì˜ registry êµ¬ì„± ìš”ì†Œë“¤ì€ apply ëª…ë ¹ì— ì˜í•´ ì—…ë°ì´íŠ¸ë˜ì§€ë§Œ, ê° êµ¬ì„± ìš”ì†Œë“¤ì˜ ë©”íƒ€ë°ì´í„°ëŠ” materialization ê³¼ ê°™ì€ ì‘ì—…ì— ì˜í•´ ì—…ë°ì´íŠ¸ ê°€ëŠ¥í•¨
                - registry ë‚´ ëª¨ë“  Feature View ë“¤ì„ í™•ì¸í•˜ê³  ì‹¶ì€ ê²½ìš°
                
                ```python
                fs = FeatureStore("my_feature_repo/")
                print(fs.list_feature_views())
                ```
                
                - registry ë‚´ íŠ¹ì • Feature View ë¥¼ í™•ì¸í•˜ê³  ì‹¶ì€ ê²½ìš°
                
                ```python
                fs = FeatureStore("my_feature_repo/")
                fv = fs.get_feature_view(â€œmy_fv1â€)
                ```
                
            - provider
                - provider ë³„ë¡œ êµ¬ì„± ìš”ì†Œ(Offline Store, Online Store, Infra, Computing) í™œìš©
                    - ì˜ˆ) GCP : [BigQuery](https://cloud.google.com/bigquery) ë¥¼ Offline Store, [Datastore](https://cloud.google.com/datastore) ë¥¼ Online Store
                - ê¸°ë³¸ Provider : Local / GCP / AWS
                - providerì˜ ì†”ë£¨ì…˜ ì™¸ì— ë³‘í–‰ ì‚¬ìš© ê°€ëŠ¥
                    - ì˜ˆ) GCP : DataStore ëŒ€ì‹  Redis ë¥¼ Online Store ë¡œ ì‚¬ìš©
                - provider ë¥¼ [ì‚¬ìš©ì ì •ì˜](https://docs.feast.dev/how-to-guides/creating-a-custom-provider)í•˜ì—¬ ì‚¬ìš©ë„ ê°€ëŠ¥í•¨
    - ì›ë³¸ ë°ì´í„° í™•ì¸
        
        ```bash
        import pandas as pd
        pd.read_parquet("data/driver_stats.parquet")
        ```
        
    - ì •ì˜ëœ Feature ë“¤ì„ ì ìš©(ë°°í¬)í•˜ê¸°
        - ì ìš© ì „ì— feature_repo ì— ìˆëŠ” notebook ê´€ë ¨ íŒŒì¼ ì‚­ì œ í•„ìš”
        
        ```python
        !rm -rf .ipynb_checkpoints/
        !feast apply
        ```